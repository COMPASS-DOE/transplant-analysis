---
title: "PNNL/SERC Soil Transplant Experiment - Data Visualization and Statistical Analysis"
author: "Anya Hopple and Ben Bond-Lamberty"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(lubridate)
library(tidyr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(ggpubr)
library(rstatix)
library(zoo)
theme_set(theme_bw())
```
# JUSTIFICATION:
* Forest ecosystems are important agents of water, nutrient, carbon, and energy flux that dominate biogeochemical cycling at scales ranging from watersheds to landscapes to planets. Most notably, these ecosystems are dominant terrestrial sources and sinks of greenhouse gasses, storing 45% of terrestrial carbon and contributing 50% of terrestrial net primary production.
* Water is a key variable that simultaneously controls and responds to all other biological, physical, and chemical processes in forest ecosystems. The mechanisms by which changes in water availability and distribution regulate soil biogeochemistry and greenhouse gas emissions has been investigated in upland forests and to a lesser extent in wetland forests.
* The frequency of extreme events is increasing worldwide, exposing coastal forests to novel hydrologic regimes and the consequences of such events are penetrating deeper into these ecosystems with sea-level rise and increasingly intense precipitation events. 
* Understanding coastal forest responses to changing salinity and inundation is critical to enhancing our ability to predict shifts in local and global biogeochemical cycling.

# RESEARCH QUESTIONS:
What are the effects of changing oligohaline seawater exposure on coastal forest soil carbon cycling and underlying chemical drivers in soils with **(A.)** and without **(B.)** seawater and inundation legacies?

A. = proxy for press disturbance, such as sea level rise
B. = proxy for pulse disturbance, such as extreme storm surge

# HYPOTHESES:
**(A.)** When soils have a history of exposure to seawater and prolonged inundation, increasing oligohaline seawater exposure will stimulate CO2 flux due to (1) heightened sulfate availability, (2) minimal osmotic stress, (3) higher carbon quality, and (4) greater cation exchange capacity.

**(B.)** When soils have no history of exposure to seawater and prolonged inundation, increasing oligohaline seawater exposure will suppress CO2 flux due to increased microbial community stress, resulting from osmotic regulation and decreased oxygen availability.

# EXPERIMENT:
* This experiment took advantage of natural salinity and elevation gradients along a tidal creek at the Smithsonian Environmental Research Center in eastern Maryland, U.S.A, to examine how coastal forest soil carbon cycling and chemistry may change under novel hydrologic regimes.
* Large (40 cm wide, 20 cm deep) soil cores were transplanted in a reciprocal design between plots varying in seawater exposure and inundation.
* Soil carbon dioxide and methane fluxes were monitored ~semi-monthly for two years (April 2018-April 2020) and six months (October 2019-April 2020), respectively. Soil temperature and volumetric water content at 5 cm were recorded during each sampling event. 
* Soil samples (0-5, 5-10, and 10-20 cm) were collected from each soil mesocosm in April 2020 for a suite of soil chemistry analyses.

# RESULTS:
## Soils with seawater exposure legacy 

```{r variation in site salinity mean and range, eval=FALSE, echo=FALSE}
#Conductivity data from the Soil Transplant and Marsh Organ Experiments were combined to assess site salinity

#Package wql: Exploring Water Quality and Monitoring data and Function ec2pss were used to convert data from 
#electrical conductivity to ppt

#Values were then exported into Transplant_Salinity.csv
sal <- read.csv("Transplant_Salinity.csv")

sal %>%
  separate(Sampling_Event, into=c("Month", "Day", "Year"), sep = "/") %>%
  unite("Date", Year, Month, Day, sep="-") %>%
  mutate(Date=as.Date(Date)) %>%
  mutate(Site = factor(Site, levels=c("NorthFork", "CanoeShed", "GCREW"), labels=c("Low Salinity Site", "Mid Salinity Site", "High Salinity Site"))) %>%
  #Adding julian day
  mutate(jday = yday(Date)) ->
  sal

#Visualizing salinity changes over time using julian days
ggplot() +
  geom_point(aes(sal$jday, sal$meanSal, color=sal$Site),size=1.5) +
  xlab("Julian Day") +
  ylab("Salinity (ppt)") +
  scale_color_manual(values=c("turquoise3","gold2","violetred2"))

sal %>%
  group_by(Site) %>%
  get_summary_stats(meanSal, type="mean_sd") ->
  sal_mean

ggplot() +
  geom_point(aes(sal$meanSal, sal$Site, color=sal$Site),size=1.5) +
  geom_point(aes(sal_mean$mean, sal_mean$Site, color=sal_mean$Site), size=5) +
  xlab("Salinity (ppt)") +
  ylab("") +
  theme(axis.text.x=element_text(face = "bold", size = 14),
        axis.text.y=element_text(face="bold", size=16),
        axis.title=element_text(face="bold", size=16),
        legend.position = "none") +
  scale_color_manual(values=c("turquoise3","gold2","violetred2"))
```





